@using Finalproj.Models
@{
    ViewData["Title"] = "Movimentos";
    var tipo = ViewData["Tipo"] as string ?? "";
    var entradas = ViewData["Entradas"] as List<EntradaPaiol> ?? new List<EntradaPaiol>();
    var saidas = ViewData["Saidas"] as List<SaidaPaiol> ?? new List<SaidaPaiol>();
}
<h1>Movimentos</h1>
<p class="text-muted">Consulte as entradas ou as saídas dos paióis. Pode filtrar por paiol.</p>

<div class="card mb-3">
    <div class="card-body">
        <form method="get" asp-action="Movimentos" class="row g-2 align-items-end">
            <div class="col-12 col-md-4">
                <label class="form-label small text-muted">Tipo de movimento</label>
                <select name="tipo" class="form-select">
                    <option value="">— Escolher —</option>
                    <option value="Entradas" selected="@(tipo == "Entradas")">Entradas</option>
                    <option value="Saidas" selected="@(tipo == "Saidas")">Saídas</option>
                </select>
            </div>
            <div class="col-12 col-md-4">
                <label class="form-label small text-muted">Paiol</label>
                <select name="paiolId" class="form-select" asp-items="@(ViewData["PaiolId"] as SelectList)">
                    <option value="">— Todos —</option>
                </select>
            </div>
            <div class="col-12 col-md-2">
                <button type="submit" class="btn btn-primary w-100">Ver</button>
            </div>
        </form>
    </div>
</div>

@if (tipo == "Entradas" && entradas.Any())
{
    <h5>Entradas</h5>
    <table class="table">
        <thead>
            <tr>
                <th>Data</th>
                <th>Paiol</th>
                <th>Produto</th>
                <th>Quantidade</th>
                <th>NEM (kg)</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var e in entradas)
            {
                <tr>
                    <td>@e.DataEntrada.ToLocalTime().ToString("g")</td>
                    <td>@e.Paiol?.Nome</td>
                    <td>@e.Produto?.Nome</td>
                    <td>@e.Quantidade.ToString("N2")</td>
                    <td>@((e.Quantidade * (e.Produto?.NEMPorUnidade ?? 0)).ToString("N2"))</td>
                </tr>
            }
        </tbody>
    </table>
}
else if (tipo == "Entradas")
{
    <p class="text-muted">Nenhuma entrada encontrada para os filtros selecionados.</p>
}

@if (tipo == "Saidas" && saidas.Any())
{
    <h5>Saídas</h5>
    <table class="table">
        <thead>
            <tr>
                <th>Data</th>
                <th>Paiol</th>
                <th>Produto</th>
                <th>Quantidade</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var s in saidas)
            {
                <tr>
                    <td>@s.DataSaida.ToLocalTime().ToString("g")</td>
                    <td>@s.Paiol?.Nome</td>
                    <td>@s.Produto?.Nome</td>
                    <td>@s.Quantidade.ToString("N2")</td>
                </tr>
            }
        </tbody>
    </table>
}
else if (tipo == "Saidas")
{
    <p class="text-muted">Nenhuma saída encontrada para os filtros selecionados.</p>
}

@if (string.IsNullOrEmpty(tipo))
{
    <p class="text-muted">Selecione o tipo de movimento (Entradas ou Saídas) e, se quiser, um paiol. Depois clique em Ver.</p>
}

<p class="mt-3">
    <a asp-action="Index" class="btn btn-outline-secondary">Voltar ao Armazém</a>
</p>
